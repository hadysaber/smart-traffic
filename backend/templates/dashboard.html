<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Smart Traffic Dashboard</title>
  <style>
    body{font-family:Arial;margin:20px;background:#f6f7f9}
    .grid{display:grid;grid-template-columns:repeat(3,minmax(260px,1fr));gap:16px}
    .card{background:#fff;border-radius:14px;padding:16px;box-shadow:0 2px 10px rgba(0,0,0,.06);border-left:6px solid #22c55e}
    .title{font-weight:700;margin-bottom:10px;display:flex;gap:8px;align-items:center}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .kpi{flex:1;min-width:120px;background:#f3f4f6;border-radius:12px;padding:12px;text-align:center}
    .kpi .num{font-size:28px;font-weight:800}
    .controls{display:grid;grid-template-columns:repeat(4,minmax(140px,1fr));gap:10px}
    button{border:0;border-radius:12px;padding:12px 14px;font-weight:700;cursor:pointer}
    button.primary{background:#22c55e;color:#fff}
    button.gray{background:#e5e7eb}
    .small{color:#6b7280;font-size:13px;margin-top:8px}
    @media(max-width:900px){.grid{grid-template-columns:1fr}.controls{grid-template-columns:1fr 1fr}}
  </style>
</head>
<body>
  <h2 style="margin:0 0 12px;">Real-time Traffic Dashboard</h2>

  <div class="grid">
    <div class="card">
      <div class="title">üöó Vehicle Counts</div>
      <div class="row">
        <div class="kpi"><div>NORTH</div><div class="num" id="n">-</div></div>
        <div class="kpi"><div>EAST</div><div class="num" id="e">-</div></div>
        <div class="kpi"><div>SOUTH</div><div class="num" id="s">-</div></div>
        <div class="kpi"><div>WEST</div><div class="num" id="w">-</div></div>
      </div>
      <div class="small" id="totals">Total: - | NS: - | EW: -</div>
    </div>

    <div class="card">
      <div class="title">‚è±Ô∏è Timings</div>
      <div class="row">
        <div class="kpi"><div>NS Green</div><div class="num" id="nsGreen">-</div><div>s</div></div>
        <div class="kpi"><div>EW Green</div><div class="num" id="ewGreen">-</div><div>s</div></div>
        <div class="kpi"><div>Cycle</div><div class="num" id="cycle">-</div><div>s</div></div>
      </div>
      <div class="small" id="pattern">Pattern: -</div>
      <div class="small" id="lastUpdate">Last update: -</div>
    </div>

    <div class="card">
      <div class="title">üéÆ Controls</div>
      <div class="controls">
        <button class="primary" onclick="sendCounts([20,2,20,2])">NS Heavy</button>
        <button class="primary" onclick="sendCounts([2,20,2,20])">EW Heavy</button>
        <button class="primary" onclick="sendCounts([8,8,8,8])">Balanced</button>
        <button class="gray" onclick="sendCounts([5,5,5,5])">Reset</button>
      </div>
      <div class="small">Buttons POST to <code>/api/process_counts</code>.</div>
    </div>
  </div>

<script>
  async function refresh(){
    const r = await fetch("/api/status");
    const st = await r.json();

    const c = st.last_counts || [0,0,0,0];
    document.getElementById("n").textContent = c[0];
    document.getElementById("e").textContent = c[1];
    document.getElementById("s").textContent = c[2];
    document.getElementById("w").textContent = c[3];

    const ns = c[0] + c[2];
    const ew = c[1] + c[3];
    document.getElementById("totals").textContent = `Total: ${ns+ew} | NS: ${ns} | EW: ${ew}`;

    const t = st.last_timings || {};
    const p = t.predictions || {};
    document.getElementById("nsGreen").textContent = p.ns_green ?? "-";
    document.getElementById("ewGreen").textContent = p.ew_green ?? "-";
    document.getElementById("cycle").textContent = p.total_cycle ?? "-";

    const a = t.analysis || {};
    document.getElementById("pattern").textContent = `Pattern: ${a.pattern ?? "-"}`;
    document.getElementById("lastUpdate").textContent = `Last update: ${st.last_update_timestamp ?? "-"}`;
  }

  async function sendCounts(arr){
    await fetch("/api/process_counts", {
      method:"POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({car_counts: arr})
    });
    await refresh();
  }

  refresh();
  setInterval(refresh, 1000);
</script>
</body>
</html>
